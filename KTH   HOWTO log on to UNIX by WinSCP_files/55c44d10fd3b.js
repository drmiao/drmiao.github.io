(function($){"use strict";var CLICK_TO_UNREAD='Läst. Klicka för att markera som oläst',CLICK_TO_READ='Oläst. Klicka för att markera som läst',NEW='Ny';var personal_menu=$('#kth-pmenu, .kthsocial');$(document).on('click','#notice-unseen',function(){personal_menu.find('form#notice-filter').submit();});$(document).on('mouseenter','#kth-pmenu .notice-marker, .kthsocial .notice-marker',function(event){var marker=$(event.currentTarget);if(marker.hasClass('white')||(marker.hasClass('blue')&&marker.hasClass('icon-record-outline'))){marker.attr('title',CLICK_TO_UNREAD);}else if(marker.hasClass('orange')){marker.attr('title',NEW);}else{marker.attr('title',CLICK_TO_READ);}});function decreaseCount(){personal_menu.find(".notices-unread").each(function(){var count=$(this).text();if(count>0){count--;}
$(this).text(count);});}
function increaseCount(){personal_menu.find(".notices-unread").each(function(){var count=$(this).text();count++;$(this).text(count);});}
function showIconRecord(marker){marker.addClass('blue');marker.addClass('icon-record');}
$(document).on('click','#kth-pmenu .notice-marker, .kthsocial .notice-marker',function(event){personal_menu=$('#kth-pmenu, .kthsocial');var marker=$(event.currentTarget);if(marker.hasClass('blue')&&marker.hasClass('icon-record')){$.ajax({type:"POST",url:'/social/notifications/mark_notice_read/',data:"link="+marker.attr('notice-link')+"&time="+marker.attr('notice-time')+"&js=auto"}).done(function(data){marker.removeClass('icon-record');marker.addClass('icon-record-outline');decreaseCount();}).fail(function(){close();});}else if(marker.hasClass('blue')&&marker.hasClass('icon-record-outline')){$.ajax({type:"POST",url:'/social/notifications/mark_notice_unread/',data:"link="+marker.attr('notice-link')+"&time="+marker.attr('notice-time')+"&js=auto"}).done(function(data){marker.removeClass('icon-record-outline');marker.addClass('icon-record');increaseCount();}).fail(function(){close();});}else if(marker.hasClass('white')){$.ajax({type:"POST",url:'/social/notifications/mark_notice_unread/',data:"link="+marker.attr('notice-link')+"&js=auto"}).done(function(data){marker.removeClass('white');showIconRecord(marker);increaseCount();}).fail(function(){close();});}else{if(marker.hasClass('icon-record-outline')){increaseCount();}else{decreaseCount();}
$.ajax({type:"POST",url:'/social/notifications/mark_notice_read/',data:"link="+marker.attr('notice-link')+"&js=auto"}).done(function(data){marker.removeClass('icon-record-outline');showIconRecord(marker);}).fail(function(){close();});}});}(jQuery));