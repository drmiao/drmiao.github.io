<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>JS API</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<script type="text/javascript" src="fsplayer.js"></script>
	<script type="text/javascript" src="swfobject.js"></script>
</head>
<body>
	<table>
		<tr style="height: 490px">
			<td style="width: 650px">
				<div id="movieArea"/>
			</td>
			<td>
				<select id="log" size="2" style="width: 300px; height: 480px"/>
			</td>
		</tr>
		<tr>
			<td>
				<input type="button" value="Previous slide" onClick="javascript:gotoPrevSlide()">
				<input id="playPause" type="button" value="Play / Pause" onClick="javascript:playPause()">
				<input type="button" value="NextSlide" onClick="javascript:gotoNextSlide()">
				&nbsp&nbsp&nbsp
				<input id="volumeEdit" type="text" value="0.7" size="3" maxlength="4">
				<input type="button" value="Set Volume" onClick="javascript:changeVolume()">
				<b id="indexLabel"></b>
			</td>
			<td>
				<input 
					id="loadUnloadButton" 
					type="button" 
					value="Load"
					onclick="javascript:onLoadUnloadButtonClick(this)"
					disabled="disabled">
			</td>
		</tr>
	</table>

	<script type="text/javascript">
		function log(str)
		{
			var log = document.getElementById("log");
			if (log)
			{
				var options = log.options;
				if (options)
				{
					options.add(new Option(str));
				}
			}	
		}
		
		var pc = null;
		var soundCtrl = null;
		var presInfo = null;
		var slideCollection = null;
		var slideCount = null;

		var loader = new fsplayer.api.PresentationLoader();
		loader.onPlayerInit = function(player)
		{
			var loadUnloadButton = document.getElementById("loadUnloadButton");
			loadUnloadButton.disabled = false;
			loadUnloadButton.value = "Unload";
			
			pc = player.getPlaybackController();
			soundCtrl = player.getSoundController();
			presInfo = player.getPresentationInfo();
			slideCollection = presInfo.getSlides();
			slideCount = slideCollection.getSlidesCount();
			pc.enableAllEventHandlers();
			soundCtrl.setChangeVolumeHandler();

			pc.onCurrentSlideIndexChanged = function(slideIndex)
			{
				setIndexLabel(slideIndex);
				log("onCurrentSlideIndexChanged, slideIndex=" + slideIndex);
			}
			
			pc.onPausePlayback = function()
			{
				log("onPausePlayback");
				updatePlayPauseLabel(true);
			}

			pc.onStartPlayback = function()
			{
				log("onStartPlayback");
				updatePlayPauseLabel(false);
			}

			pc.onPlaybackSuspended = function()
			{
				log("onPlaybackSuspended");
			}

			pc.onPlaybackResumed = function()
			{
				log("onPlaybackResumed");
			}

			pc.onAnimationStepChanged = function(stepIndex)
			{
				log("onAnimationStepChanged, stepIndex=" + stepIndex);
			}

			pc.onSlidePositionChanged = function(position)
			{
				if (position == 1)
				{
					log("onSlidePositionChanged, position=" + position);
				}
			}

			pc.onSlideLoadingComplete = function(slideIndex)
			{
				log("onSlideLoadingComplete, slideIndex=" + slideIndex);
			}

			pc.onPresentationPlaybackComplete = function()
			{
				log("onPresentationPlaybackComplete");
			}

            pc.onCallCloseRequest = function()
            {
                log("onCallCloseRequest");
            };
			
			soundCtrl.onSoundVolumeChanged = function(newVolume)
			{
				log("onSoundVolumeChanged, newVolume=" + newVolume);
			}

            var skinUIController = player.getSkinUIController();
            skinUIController.setCloseRequestHandler();
            skinUIController.onCallCloseRequest = function()
            {
                log("onCallCloseRequest");
            };
		}
		
		function updatePlayPauseLabel(play)
		{
			var playPause = document.getElementById("playPause");
			if (playPause)
			{
				playPause.value = play ? "Play" : "Pause";
			}
		}
		
		function playPause()
		{
			if (pc != null)
			{
				pc.isPlaying() ? pc.pause() : pc.play();
			}
		}

		function gotoPrevSlide()
		{
			if (pc != null)
			{
				pc.gotoPreviousSlide(true);
			}
		}

		function gotoNextSlide()
		{
			if (pc != null)
			{
				pc.gotoNextSlide(true);
			}
		}

		function setIndexLabel(index)
		{
			var indexLabel = document.getElementById("indexLabel");
			if (indexLabel)
			{
				indexLabel.innerHTML = "Slide: " + (index + 1) + " / " + slideCount;
			}
		}
		
		function changeVolume()
		{
			if (soundCtrl == null)
				return;
			
			var volumeEdit = document.getElementById("volumeEdit");
			if (volumeEdit)
			{
				var vol = parseFloat(volumeEdit.value);
				if (!isNaN(vol))
				{
					soundCtrl.setVolume(vol);
				}
			}
		}

		function onLoadUnloadButtonClick(btn)
		{
			switch (btn.value)
			{
			case "Load":
				loadPresentation();
				btn.disabled = true;
				break;
			case "Unload":
				unloadPresentation();
				btn.value = "Load";
				break;
			}
		}

		function loadPresentation()
		{
			loader.load("presentation.swf", document.getElementById("movieArea"), "newPlayerId", 640, 480);
		}
		
		function unloadPresentation(btn)
		{
			loader.unload();

			pc = null;
			soundCtrl = null;
			presInfo = null;
			slideCollection = null;
			slideCount = null;

			//clear log
			var log = document.getElementById("log");
			log.innerHTML = "";
		}
		
		loadPresentation();
	</script>
</body>
</html>
